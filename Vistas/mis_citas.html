<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <style>

    .side_left, .side_right {
        margin-top: 50px;
        margin-left: 15px;
        margin-right: 15px;
        width: 48%;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0);
        border-radius: 8px;
        
    }

    .side_left {
        float: left;
        
    }

    .side_right {
        float: right;
        
    }

    p {
    margin-bottom: 20px;
    font-size: 16px;
    }

    #calendar-container {
        margin-left: 100px;
        text-align: center;
    }

    
    .form-container {
        margin-left: 150px;
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 400px;
        text-align: center;
    }

    .form-container h1 {
        color: #333;
        margin-bottom: 20px;
    }
    

    #footer {
    clear: both;
    text-align: center;
    margin-top: 50px;
    padding: 20px;
    font-size: 14px;
    color: #777;}

    .form-container h1 {
        color: #333;
        margin-bottom: 20px;
    }

    .form-container label {
        font-size: 16px;
        color: #555;
        display: block;
        margin-bottom: 8px;
        text-align: left;
    }

    .form-container input, .form-container textarea {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }

    .form-container button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
        margin-top: 20px;
        width: 100%;
    }

    .form-container button:hover {
        background-color: #0056b3;
    }


    .form-container .info {
        margin-top: 15px;
        font-size: 14px;
        color: #777;
    }
    .form-container select {
        width: 105%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }
    .form-container textarea {
        height: 100px;
        resize: none;
    }
  </style>
</head>

<body>

    <div id="header"></div>

    <div class="side_left">
        <div id="calendar-container">
            <h1>Calendario de Citas</h1>
            <p>Consulta tus citas programadas a través de nuestro calendario.</p>
            <iframe src="https://calendar.google.com/calendar/embed?src=udemedellin.soy%40gmail.com&ctz=America%2FBogota" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
        </div>
    </div>

    <div class="side_right">
        <div id="form-container" class="form-container">
            <h1>Solicitud de Cita</h1>
            <p>Agenda con un asesor.</p>
            <form id="CreateEvent" method="POST">

                <label>Nombre de la Reunión</label>
                <select name="name">
                    <option value="">Ponle un título a tu reunión</option>
                    <option value="Información Académica">Información Académica</option>
                    <option value="Becas y Apoyos Financieros">Becas y Apoyos Financieros</option>
                    <option value="Facturación UdeM">Facturación UdeM</option>
                    <option value="Asesoría Académica">Asesoría Académica</option>
                    <option value="Trámites y Asesoría">Trámites y Asesoría</option>
                    <option value="Otros">Otros</option>
                  </select>
            
                <label >Descripción</label>
                <textarea id="description" name="description" placeholder="Describenos tu duda, problema o motivo de la reunion" required></textarea>

                <label>Fecha</label>
                <input type="date" id="date" name="date" required>

                <label for="time">Hora</label>
                <select id="time" name="time" required>
                  <option value="">Seleccione un horario</option>
                  <option value="08:00:00">08:00</option>
                  <option value="08:25:00">08:25</option>
                  <option value="08:50:00">08:50</option>
                  <option value="09:15:00">09:15</option>
                  <option value="09:40:00">09:40</option>
                  <option value="10:05:00">10:05</option>
                  <option value="10:30:00">10:30</option>
                  <option value="10:55:00">10:55</option>
                  <option value="11:20:00">11:20</option>
                  <option value="11:45:00">11:45</option>
                  <option value="14:00:00">14:00</option>
                  <option value="14:25:00">14:25</option>
                  <option value="14:50:00">14:50</option>
                  <option value="15:15:00">15:15</option>
                  <option value="15:40:00">15:40</option>
                  <option value="16:05:00">16:05</option>
                  <option value="16:30:00">16:30</option>
                  <option value="16:55:00">16:55</option>
                  <option value="17:20:00">17:20</option>
                  <option value="17:55:00">17:55</option>
                </select>

                <button type="submit">Agendar</button>

                <p class="info">Recibirás un correo de confirmación una vez que tu cita sea agendada con el respectivo link para la cita virtual.</p>
            </form>
    </div>
    
    <div id="footer">
        <p>&copy; 2025 Tu Canala UdeM. Todos los derechos reservados.</p>
    <div>
        
</body>
    <script src="load_header.js"></script>
<script>
    document.getElementById('CreateEvent').addEventListener('submit', async function (e) {
      e.preventDefault(); 

      const formData = new FormData(this);
      const date = formData.get('date');      
      const time = formData.get('time'); 
      const start = new Date(`${date}T${time}-05:00`);
      const end = new Date(start.getTime() + 25 * 60000);

      const datos = {
        name: formData.get('name'),
        description: formData.get('description'),
        date: formData.get('date'),
        time: formData.get('time')
      };

      const validate ={
        start: start.toISOString(),
        end: end.toISOString()
      }

      try {
        const response = await fetch('http://localhost:5000/tu_canal_udem/getEvents', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(validate)
        });
  
        const resultado = await response.json();
        if (!response.ok) {
            alert("Error al verificar la cita. "+resultado.error);
        }
        if(resultado.length > 0){
            return alert('Ya existe una cita en ese horario. Elige otro.');
        }
        } catch (err) {
        console.error(err);
        return alert('Error de conexión al verificar cita.');
    }
        try {
        const response = await fetch('http://localhost:5000/tu_canal_udem/createEvent', {
          method: 'POST',
          headers: {
          'Content-Type': 'application/json'
          },
          body: JSON.stringify(datos)
        });
  
        const resultado = await response.json();

        if (!response.ok) {
            alert("Error al crear la cita. "+ resultado.error);
        }
        else {
            alert("Cita creada exitosamente");}   
    
        }catch (error) {
        alert('Error al verificar cita. Intenta nuevamente.');
        console.error(error);
      }
    });     
</script>

</html>